<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Family Tasks</title>

  <!-- Firebase Classic SDK (Compat) -->
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-database-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyA6hkZDTQrqhS6Wcm9z8ADm5It-wck7U8",
      authDomain: "chores-c86f4.firebaseapp.com",
      databaseURL: "https://chores-c86f4-default-rtdb.firebaseio.com",
      projectId: "chores-c86f4",
      storageBucket: "chores-c86f4.appspot.com",
      messagingSenderId: "503520134350",
      appId: "1:503520134350:web:0ce4fc7c3c011eaa0cbc9f"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
  </script>

  <style>
    :root {
      --bg-light: #f0f0f0;
      --bg-dark: #1e1e1e;
      --text-light: #000;
      --text-dark: #fff;
      --table-light: #fff;
      --table-dark: #2a2a2a;
      --border: #ccc;
      --accent: green;
    }

    body {
      font-family: Arial;
      padding: 20px;
      background: var(--bg-light);
      color: var(--text-light);
      transition: background 0.3s, color 0.3s;
    }

    body.dark {
      background: var(--bg-dark);
      color: var(--text-dark);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: var(--table-light);
    }

    body.dark table {
      background: var(--table-dark);
    }

    th, td {
      border: 1px solid var(--border);
      padding: 10px;
      text-align: center;
    }

    th {
      background: #eee;
    }

    .task {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .approved {
      color: var(--accent);
      font-weight: bold;
    }

    h1 {
      text-align: center;
      margin-bottom: 20px;
    }

    .footer-note {
      margin-top: 30px;
      text-align: center;
      font-style: italic;
    }

    #reset-section {
      text-align: center;
      margin-top: 20px;
    }

    #theme-toggle {
      position: absolute;
      top: 20px;
      right: 20px;
    }
  </style>
</head>
<body>
  <h1>Family Tasks</h1>
  <button id="theme-toggle" onclick="toggleTheme()">Toggle Dark Mode</button>
  <table>
    <thead>
      <tr><th>Day</th><th>Jacob</th><th>Jalyna</th><th>Josh</th><th>Jeremy</th></tr>
    </thead>
    <tbody id="chore-body"></tbody>
  </table>

  <div id="reset-section">
    <button onclick="resetAllTasks()" style="padding: 10px 20px; font-size: 16px;">Reset All Tasks</button>
  </div>

  <div class="footer-note" id="recycling-note"></div>
  <div class="footer-note">
    ‚úÖ Complete tasks to regain Wi-Fi privileges. Parent approval required.
  </div>

  <script>
    const isParent = new URLSearchParams(window.location.search).get("user") === "parent";
    const chores = {
      Monday: {
        Jacob: ["Vacuum common areas", "Scoop/clean cat litter"],
        Jalyna: ["Wash dishes"],
        Josh: ["Take out trash"],
        Jeremy: ["Clean bedroom"]
      },
      Tuesday: {
        Jacob: ["Scoop/clean cat litter"],
        Jalyna: ["Wash dishes"],
        Josh: ["Wash dishes", "Take recycling to front curb"],
        Jeremy: ["Clean bedroom"]
      },
      Wednesday: {
        Jacob: ["Wash dishes", "Take trash to front curb"],
        Jalyna: ["Wipe down surfaces", "Scoop/clean cat litter"],
        Josh: ["Clean windows"],
        Jeremy: ["Clean bedroom"]
      },
      Thursday: {
        Jacob: ["Vacuum basement steps"],
        Jalyna: ["Wash dishes"],
        Josh: ["Wipe down appliances", "Scoop/clean cat litter"],
        Jeremy: ["Clean bedroom"]
      },
      Friday: {
        Jacob: ["Dust and sweep first floor"],
        Jalyna: ["Clean bathroom", "Scoop/clean cat litter"],
        Josh: ["Wash dishes"],
        Jeremy: ["Clean bedroom"]
      },
      Saturday: {
        Jacob: ["Wash dishes", "Scoop/clean cat litter"],
        Jalyna: ["Organize shared space"],
        Josh: ["Organize basement"],
        Jeremy: ["Clean bedroom"]
      },
      Sunday: {
        Jacob: [],
        Jalyna: [],
        Josh: [],
        Jeremy: []
      }
    };

    const names = ["Jacob", "Jalyna", "Josh", "Jeremy"];

    function syncTask(id, status) {
      db.ref("tasks/" + id).set(status);
    }

    function updateTaskUI(id, status) {
      const checkbox = document.getElementById(`${id}-checkbox`);
      const statusSpan = document.getElementById(`${id}-status`);
      const approveBtn = document.getElementById(`${id}-approve`);
      if (!checkbox || !statusSpan) return;

      if (status === "approved") {
        checkbox.checked = true;
        checkbox.disabled = true;
        statusSpan.textContent = "‚úÖ Approved";
        statusSpan.classList.add("approved");
        if (approveBtn) approveBtn.style.display = "none";
      } else if (status === "pending") {
        checkbox.checked = true;
        statusSpan.textContent = "Pending";
        if (approveBtn && isParent) approveBtn.style.display = "inline-block";
      } else {
        checkbox.checked = false;
        statusSpan.textContent = "";
        if (approveBtn) approveBtn.style.display = "none";
        checkbox.disabled = false;
      }
    }

    function toggleTask(checkbox, id) {
      if (checkbox.checked) {
        syncTask(id, "pending");
        updateTaskUI(id, "pending");
      } else {
        syncTask(id, "");
        updateTaskUI(id, "");
      }
    }

    function approveTask(id) {
      if (!isParent) return;
      syncTask(id, "approved");
      updateTaskUI(id, "approved");
    }

    function resetAllTasks() {
      if (!isParent) return;
      if (confirm("Are you sure you want to reset all tasks?")) {
        db.ref("tasks").remove();
        location.reload();
      }
    }

    function toggleTheme() {
      document.body.classList.toggle("dark");
    }

    function renderChores() {
      const tbody = document.getElementById("chore-body");
      Object.keys(chores).forEach(day => {
        const row = document.createElement("tr");
        const dayCell = document.createElement("td");
        dayCell.textContent = day;
        row.appendChild(dayCell);

        names.forEach(name => {
          const cell = document.createElement("td");
          const tasks = chores[day][name] || [];
          if (tasks.length === 0) {
            cell.innerHTML = "<em>Free</em>";
          } else {
            tasks.forEach((task, i) => {
              const id = `${name.toLowerCase()}-${day.toLowerCase()}-${i}`;
              const div = document.createElement("div");
              div.className = "task";

              const label = document.createElement("label");
              const checkbox = document.createElement("input");
              checkbox.type = "checkbox";
              checkbox.id = `${id}-checkbox`;
              checkbox.onchange = () => toggleTask(checkbox, id);
              label.appendChild(checkbox);
              label.append(task);

              const status = document.createElement("span");
              status.id = `${id}-status`;

              const approveBtn = document.createElement("button");
              approveBtn.id = `${id}-approve`;
              approveBtn.textContent = "Approve";
              approveBtn.style.display = "none";
              approveBtn.onclick = () => approveTask(id);

              div.appendChild(label);
              div.appendChild(status);
              div.appendChild(approveBtn);
              cell.appendChild(div);
            });
          }
          row.appendChild(cell);
        });
        tbody.appendChild(row);
      });
    }

    db.ref("tasks").on("value", snapshot => {
      const data = snapshot.val() || {};
      Object.entries(data).forEach(([id, status]) => {
        updateTaskUI(id, status);
      });
    });

    document.addEventListener("DOMContentLoaded", renderChores);
  </script>

  <div class="footer-note" id="recycling-note"></div>
  <div class="footer-note">
    ‚ôªÔ∏è Recycling Reminder: Cardboard should be flattened and bundled neatly.<br>
    üïò Garbage Reminder: All trash must be brought to the curb by <strong>9:00 PM</strong>.
  </div>


  <script>
    const recyclingTypes = {
      Tuesday: "Cardboard",
      Friday: "Plastics and Cans",
      Sunday: "Paper"
    };
    const today = new Date().toLocaleString("en-US", { weekday: "long" });
    const type = recyclingTypes[today] || "None";
    const note = document.getElementById("recycling-note");
    if (note) {
      note.innerHTML = "‚ôªÔ∏è Recycling Reminder: " + type + "<br>üïò Garbage Reminder: All trash must be brought to the curb by <strong>9:00 PM</strong>.";
    }
  </script>
</body>

</html>
