<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Family Tasks</title>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-database-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyA6hkZDTQrqhS6Wcm9z8ADm5It-wck7U8",
      authDomain: "chores-c86f4.firebaseapp.com",
      databaseURL: "https://chores-c86f4-default-rtdb.firebaseio.com",
      projectId: "chores-c86f4",
      storageBucket: "chores-c86f4.appspot.com",
      messagingSenderId: "503520134350",
      appId: "1:503520134350:web:0ce4fc7c3c011eaa0cbc9f"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
  </script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f0f0f0;
      color: #000;
      padding: 20px;
    }
    body.dark {
      background-color: #1e1e1e;
      color: #fff;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: center;
    }
    th {
      background-color: #eee;
    }
    body.dark th {
      background-color: #333;
      color: #fff;
    }
    .task {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .approved {
      color: green;
      font-weight: bold;
    }
    #theme-toggle {
      position: absolute;
      top: 20px;
      right: 20px;
    }
    .footer-note {
      margin-top: 30px;
      text-align: center;
      font-style: italic;
    }
    tr.highlight {
      background-color: #dff0d8;
    }
    body.dark tr.highlight {
      background-color: #4d664d;
      color: #fff;
    }
  </style>
</head>
<body>
  <h1>Family Tasks</h1>
  <button id="theme-toggle" onclick="toggleTheme()">Toggle Dark Mode</button>
  <table>
    <thead>
      <tr><th>Day</th><th>Jacob</th><th>Jalyna</th><th>Josh</th><th>Jeremy</th></tr>
    </thead>
    <tbody id="chore-body"></tbody>
  </table>
  <div id="reset-section" style="text-align:center; margin-top:20px;">
    <button onclick="resetAllTasks()">Reset All Tasks</button>
  </div>
  <div id="recycling-note" style="text-align:center; margin-top:20px;"></div>
  <div class="footer-note">
    ‚úÖ Complete tasks to regain Wi-Fi privileges. Parent approval required.
  </div>
  <script>
    function toggleTheme() {
      document.body.classList.toggle("dark");
      localStorage.setItem("theme", document.body.classList.contains("dark") ? "dark" : "light");
    }

    const names = ["Jacob", "Jalyna", "Josh", "Jeremy"];
    const trashRotation = ["Jacob", "Jalyna", "Josh"];
    const isParent = new URLSearchParams(window.location.search).get("user") === "parent";
    const chores = {
      Monday: {
        Jacob: ["Vacuum common areas", "Scoop/clean cat litter"],
        Jalyna: ["Wash dishes"],
        Josh: ["Take out trash"],
        Jeremy: ["Clean bedroom"]
      },
      Tuesday: {
        Jacob: ["Scoop/clean cat litter"],
        Jalyna: ["Wash dishes"],
        Josh: ["Wash dishes", "Take recycling to front curb"],
        Jeremy: ["Clean bedroom"]
      },
      Wednesday: {
        Jacob: ["Wash dishes", "Take trash to front curb"],
        Jalyna: ["Wipe down surfaces", "Scoop/clean cat litter"],
        Josh: ["Clean windows"],
        Jeremy: ["Clean bedroom"]
      },
      Thursday: {
        Jacob: ["Vacuum basement steps"],
        Jalyna: ["Wash dishes"],
        Josh: ["Wipe down appliances", "Scoop/clean cat litter"],
        Jeremy: ["Clean bedroom"]
      },
      Friday: {
        Jacob: ["Dust and sweep first floor"],
        Jalyna: ["Clean bathroom", "Scoop/clean cat litter"],
        Josh: ["Wash dishes"],
        Jeremy: ["Clean bedroom"]
      },
      Saturday: {
        Jacob: ["Wash dishes", "Scoop/clean cat litter"],
        Jalyna: ["Organize shared space"],
        Josh: ["Organize basement"],
        Jeremy: ["Clean bedroom"]
      },
      Sunday: {
        Jacob: [],
        Jalyna: [],
        Josh: [],
        Jeremy: []
      }
    };

    function renderChores() {
      const tbody = document.getElementById("chore-body");
      const msInWeek = 7 * 24 * 60 * 60 * 1000;
      const rotationStart = new Date("2025-01-06");
      const today = new Date();
      const weekIndex = Math.floor((today - rotationStart) / msInWeek);
      const trashAssigneeIndex = weekIndex % trashRotation.length;
      const rotatedNames = [...names.slice(weekIndex % names.length), ...names.slice(0, weekIndex % names.length)];
      const todayStr = today.toLocaleString('en-US', { weekday: 'long' });

      Object.keys(chores).forEach(day => {
        const row = document.createElement("tr");
        const currentDate = new Date();
        const dayIndex = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"].indexOf(day);
        const diff = (dayIndex + 7 - currentDate.getDay()) % 7;
        const displayDate = new Date(currentDate);
        displayDate.setDate(currentDate.getDate() + diff);
        const dateStr = displayDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });

        if (day === todayStr) row.classList.add("highlight");

        const dayCell = document.createElement("td");
        dayCell.textContent = `${day} (${dateStr})`;
        row.appendChild(dayCell);

        rotatedNames.forEach((rotatedName, i) => {
          const originalName = names[i];
          const cell = document.createElement("td");
          const tasks = [...(chores[day][originalName] || [])];
          if (day !== "Sunday" && originalName === trashRotation[(trashAssigneeIndex + dayIndex) % trashRotation.length]) {
            tasks.push("Take trash to the bins");
          }
          if (tasks.length === 0) {
            cell.innerHTML = "<em>Free</em>";
          } else {
            tasks.forEach((task, t) => {
              const id = `${day.toLowerCase()}-${originalName.toLowerCase()}-${t}`;
              const div = document.createElement("div");
              div.className = "task";
              const label = document.createElement("label");
              const checkbox = document.createElement("input");
              checkbox.type = "checkbox";
              checkbox.id = `${id}-checkbox`;
              label.appendChild(checkbox);
              label.append(task);
              const status = document.createElement("span");
              status.id = `${id}-status`;
              const approveBtn = document.createElement("button");
              approveBtn.id = `${id}-approve`;
              approveBtn.textContent = "Approve";
              approveBtn.style.display = "none";
              approveBtn.onclick = () => approveTask(id);
              div.appendChild(label);
              div.appendChild(status);
              div.appendChild(approveBtn);
              cell.appendChild(div);
            });
          }
          row.appendChild(cell);
        });
        tbody.appendChild(row);
      });
    }

    function toggleTask(checkbox, id) {
      const status = checkbox.checked ? "pending" : "";
      db.ref("tasks/" + id).set(status);
    }

    function approveTask(id) {
      if (!isParent) return;
      db.ref("tasks/" + id).set("approved");
    }

    function resetAllTasks() {
      if (!isParent) return;
      if (confirm("Are you sure you want to reset all tasks?")) {
        db.ref("tasks").remove();
        location.reload();
      }
    }

    function updateTaskUI(id, status) {
      const checkbox = document.getElementById(`${id}-checkbox`);
      const statusSpan = document.getElementById(`${id}-status`);
      const approveBtn = document.getElementById(`${id}-approve`);
      if (!checkbox || !statusSpan) return;
      if (status === "approved") {
        checkbox.checked = true;
        checkbox.disabled = true;
        statusSpan.textContent = "‚úÖ Approved";
        statusSpan.classList.add("approved");
        if (approveBtn) approveBtn.style.display = "none";
      } else if (status === "pending") {
        checkbox.checked = true;
        checkbox.disabled = false;
        statusSpan.textContent = "Pending";
        if (approveBtn && isParent) approveBtn.style.display = "inline-block";
      } else {
        checkbox.checked = false;
        checkbox.disabled = false;
        statusSpan.textContent = "";
        if (approveBtn) approveBtn.style.display = "none";
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      if (localStorage.getItem("theme") === "dark") {
        document.body.classList.add("dark");
      }
      renderChores();
      const taskRef = db.ref("tasks");
      taskRef.on("value", snapshot => {
        const data = snapshot.val() || {};
        Object.entries(data).forEach(([id, status]) => updateTaskUI(id, status));
      });

      const recyclingTypes = ["Paper/Cardboard", "Plastic/Metal"];
      const baseDate = new Date("January 1, 2025");
      while (baseDate.getDay() !== 3) baseDate.setDate(baseDate.getDate() + 1);
      const today = new Date(); today.setHours(0, 0, 0, 0);
      const nextWednesday = new Date(today);
      const diff = (3 - today.getDay() + 7) % 7;
      nextWednesday.setDate(today.getDate() + diff);
      const weeksBetween = Math.floor((nextWednesday - baseDate) / (7 * 24 * 60 * 60 * 1000));
      const recyclingType = recyclingTypes[weeksBetween % 2];
      const note = document.getElementById("recycling-note");
      if (note) {
        note.innerHTML = `‚ôªÔ∏è Recycling Reminder: <strong>${recyclingType}</strong> will be collected on <strong>${nextWednesday.toDateString()}</strong>.<br>üïò Garbage Reminder: All trash must be brought to the curb by <strong>9:00 PM</strong>.`;
      }
    });
  </script>
</body>
</html>
