<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Family Tasks</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      padding: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
    }
    th, td {
      border: 1px solid #bbb;
      padding: 12px;
      text-align: center;
      font-size: 1.05em;
      vertical-align: top;
    }
    th {
      background-color: #e0e0e0;
      font-weight: bold;
      font-size: 1.2em;
      text-transform: uppercase;
    }
    input[type="checkbox"] {
      transform: scale(1.3);
      cursor: pointer;
      margin-right: 6px;
    }
    label {
      display: block;
      padding: 4px 0;
      font-weight: 500;
    }
    .task {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .task span {
      margin-left: 10px;
      font-style: italic;
      color: #666;
    }
    .approved {
      color: green !important;
      font-weight: bold;
    }
    h1 {
      font-size: 2em;
      margin-bottom: 20px;
      text-align: center;
      color: #333;
      text-shadow: 1px 1px 0 #ccc;
    }
    .footer-note {
      margin-top: 30px;
      text-align: center;
      font-size: 1.1em;
      color: #444;
      font-style: italic;
      background-color: #eaf6ea;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 0 6px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>
  <h1>Family Tasks</h1>
  <table>
    <thead>
      <tr>
        <th>Day</th>
        <th>Jacob</th>
        <th>Jalyna</th>
        <th>Josh</th>
        <th>Jeremy</th>
      </tr>
    </thead>
    <tbody id="chore-body"></tbody>
  </table>
  <div class="footer-note">
    ✅ Once your chores are complete and approved, Wi-Fi access will be restored. Thanks for helping out — teamwork makes the dream work!
  </div>
  <script>
    const isParent = new URLSearchParams(window.location.search).get('user') === 'parent';
    const broadcast = new BroadcastChannel('chore_channel');

    const chores = {
      Monday: {
        Jacob: ["Vacuum common areas", "Scoop/clean cat litter"],
        Jalyna: ["Wash dishes"],
        Josh: ["Take out trash"],
        Jeremy: ["Clean bedroom"]
      },
      Tuesday: {
        Jacob: ["Scoop/clean cat litter"],
        Jalyna: ["Wash dishes"],
        Josh: ["Wash dishes", "Take recycling to front curb"],
        Jeremy: ["Clean bedroom"]
      },
      Wednesday: {
        Jacob: ["Wash dishes", "Take trash to front curb"],
        Jalyna: ["Wipe down surfaces", "Scoop/clean cat litter"],
        Josh: ["Clean windows"],
        Jeremy: ["Clean bedroom"]
      },
      Thursday: {
        Jacob: ["Vacuum basement steps"],
        Jalyna: ["Wash dishes"],
        Josh: ["Wipe down appliances", "Scoop/clean cat litter"],
        Jeremy: ["Clean bedroom"]
      },
      Friday: {
        Jacob: ["Dust and sweep first floor"],
        Jalyna: ["Clean bathroom", "Scoop/clean cat litter"],
        Josh: ["Wash dishes"],
        Jeremy: ["Clean bedroom"]
      },
      Saturday: {
        Jacob: ["Wash dishes", "Scoop/clean cat litter"],
        Jalyna: ["Organize shared space"],
        Josh: ["Organize basement"],
        Jeremy: ["Clean bedroom"]
      },
      Sunday: {
        Jacob: [],
        Jalyna: [],
        Josh: [],
        Jeremy: []
      }
    };

    const names = ["Jacob", "Jalyna", "Josh", "Jeremy"];

    function syncTask(id, status) {
      localStorage.setItem(id, status);
      broadcast.postMessage({ id, status });
    }

    function updateTaskUI(id, status) {
      const checkbox = document.getElementById(`${id}-checkbox`);
      const statusSpan = document.getElementById(`${id}-status`);
      const approveBtn = document.getElementById(`${id}-approve`);
      if (!checkbox || !statusSpan) return;
      if (status === 'approved') {
        checkbox.checked = true;
        checkbox.disabled = true;
        statusSpan.textContent = '✅ Approved';
        statusSpan.classList.add('approved');
        if (approveBtn) approveBtn.style.display = 'none';
      } else if (status === 'pending') {
        checkbox.checked = true;
        statusSpan.textContent = 'Pending approval';
        if (approveBtn && isParent) approveBtn.style.display = 'inline-block';
      } else {
        checkbox.checked = false;
        statusSpan.textContent = '';
        if (approveBtn) approveBtn.style.display = 'none';
      }
    }

    function toggleTask(checkbox, id) {
      if (checkbox.checked) {
        syncTask(id, 'pending');
        updateTaskUI(id, 'pending');
      } else {
        syncTask(id, '');
        updateTaskUI(id, '');
      }
    }

    function approveTask(id) {
      if (!isParent) {
        alert('Only parents can approve tasks. Add ?user=parent to the URL.');
        return;
      }
      syncTask(id, 'approved');
      updateTaskUI(id, 'approved');
    }

    function renderChores() {
      const tbody = document.getElementById('chore-body');
      Object.keys(chores).forEach((day) => {
        const row = document.createElement('tr');
        const dayCell = document.createElement('td');
        dayCell.textContent = day;
        row.appendChild(dayCell);

        names.forEach(name => {
          const cell = document.createElement('td');
          const tasks = chores[day][name];
          if (tasks.length === 0) {
            cell.innerHTML = '<em>Free</em>';
          } else {
            tasks.forEach((task, i) => {
              const id = `${name.toLowerCase()}-${day.toLowerCase()}-${i}`;
              const wrapper = document.createElement('div');
              wrapper.className = 'task';

              const label = document.createElement('label');
              const checkbox = document.createElement('input');
              checkbox.type = 'checkbox';
              checkbox.id = `${id}-checkbox`;
              checkbox.onchange = () => toggleTask(checkbox, id);
              label.appendChild(checkbox);
              label.append(` ${task}`);

              const status = document.createElement('span');
              status.id = `${id}-status`;

              const approveBtn = document.createElement('button');
              approveBtn.id = `${id}-approve`;
              approveBtn.textContent = 'Approve';
              approveBtn.style.display = 'none';
              approveBtn.onclick = () => approveTask(id);

              wrapper.appendChild(label);
              wrapper.appendChild(status);
              wrapper.appendChild(approveBtn);
              cell.appendChild(wrapper);
            });
          }
          row.appendChild(cell);
        });
        tbody.appendChild(row);
      });
    }

    broadcast.onmessage = (event) => {
      const { id, status } = event.data;
      localStorage.setItem(id, status);
      updateTaskUI(id, status);
    };

    document.addEventListener('DOMContentLoaded', () => {
      renderChores();
      Object.keys(localStorage).forEach(key => {
        updateTaskUI(key, localStorage.getItem(key));
      });
    });
  </script>

  <script>
    function resetAllTasks() {
      if (!isParent) {
        alert('Only parents can reset tasks.');
        return;
      }
      if (confirm('Are you sure you want to reset all tasks? This will clear all approvals and checkmarks.')) {
        localStorage.clear();
        location.reload();
      }
    }
  </script>
  <div style="text-align: center; margin-top: 20px;">
    <button onclick="resetAllTasks()" style="padding: 10px 20px; font-size: 1rem; background: #ff4d4d; color: white; border: none; border-radius: 5px; cursor: pointer;">
      Reset All Tasks
    </button>
  </div>

</body>
</html>
