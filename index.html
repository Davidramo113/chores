<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Family Tasks</title>

  <!-- Firebase CDN (Classic SDK) -->
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyA6hkZDTQrqhS6Wcm9z8ADm5It-wck7U8",
      authDomain: "chores-c86f4.firebaseapp.com",
      databaseURL: "https://chores-c86f4-default-rtdb.firebaseio.com",
      projectId: "chores-c86f4",
      storageBucket: "chores-c86f4.appspot.com",
      messagingSenderId: "503520134350",
      appId: "1:503520134350:web:0ce4fc7c3c011eaa0cbc9f"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
  </script>

  <style>
    body { font-family: Arial; padding: 20px; background: #f0f0f0; }
    table { width: 100%; border-collapse: collapse; background: #fff; }
    th, td { border: 1px solid #ccc; padding: 10px; text-align: center; }
    th { background: #eee; }
    .task { display: flex; justify-content: space-between; align-items: center; }
    .approved { color: green; font-weight: bold; }
    h1 { text-align: center; margin-bottom: 20px; }
    .footer-note { margin-top: 30px; text-align: center; font-style: italic; }
  </style>
</head>
<body>
  <h1>Family Tasks</h1>
  <table>
    <thead>
      <tr><th>Day</th><th>Jacob</th><th>Jalyna</th><th>Josh</th><th>Jeremy</th></tr>
    </thead>
    <tbody id="chore-body"></tbody>
  </table>
  <div class="footer-note">
    ✅ Complete tasks to regain Wi-Fi privileges. Parent approval required.
  </div>

  <script>
    const isParent = new URLSearchParams(window.location.search).get('user') === 'parent';
    const chores = {
      Monday: {
        Jacob: ["Vacuum", "Scoop litter"],
        Jalyna: ["Dishes"],
        Josh: ["Trash"],
        Jeremy: ["Clean bedroom"]
      },
      Tuesday: {
        Jacob: ["Scoop litter"],
        Jalyna: ["Dishes"],
        Josh: ["Recycling"],
        Jeremy: ["Clean bedroom"]
      },
      Wednesday: {
        Jacob: ["Dishes"],
        Jalyna: ["Surfaces", "Scoop litter"],
        Josh: ["Windows"],
        Jeremy: ["Clean bedroom"]
      },
      Thursday: {
        Jacob: ["Basement steps"],
        Jalyna: ["Dishes"],
        Josh: ["Appliances", "Scoop litter"],
        Jeremy: ["Clean bedroom"]
      },
      Friday: {
        Jacob: ["Sweep 1st floor"],
        Jalyna: ["Bathroom", "Scoop litter"],
        Josh: ["Dishes"],
        Jeremy: ["Clean bedroom"]
      },
      Saturday: {
        Jacob: ["Dishes", "Scoop litter"],
        Jalyna: ["Organize space"],
        Josh: ["Organize basement"],
        Jeremy: ["Clean bedroom"]
      },
      Sunday: {
        Jacob: [],
        Jalyna: [],
        Josh: [],
        Jeremy: []
      }
    };
    const names = ["Jacob", "Jalyna", "Josh", "Jeremy"];

    function syncTask(id, status) {
      db.ref("tasks/" + id).set(status);
    }

    function updateTaskUI(id, status) {
      const checkbox = document.getElementById(`${id}-checkbox`);
      const statusSpan = document.getElementById(`${id}-status`);
      const approveBtn = document.getElementById(`${id}-approve`);
      if (!checkbox || !statusSpan) return;

      if (status === "approved") {
        checkbox.checked = true;
        checkbox.disabled = true;
        statusSpan.textContent = "✅ Approved";
        statusSpan.classList.add("approved");
        if (approveBtn) approveBtn.style.display = "none";
      } else if (status === "pending") {
        checkbox.checked = true;
        statusSpan.textContent = "Pending";
        if (approveBtn && isParent) approveBtn.style.display = "inline-block";
      } else {
        checkbox.checked = false;
        statusSpan.textContent = "";
        if (approveBtn) approveBtn.style.display = "none";
        checkbox.disabled = false;
      }
    }

    function toggleTask(checkbox, id) {
      if (checkbox.checked) {
        syncTask(id, "pending");
        updateTaskUI(id, "pending");
      } else {
        syncTask(id, "");
        updateTaskUI(id, "");
      }
    }

    function approveTask(id) {
      if (!isParent) return;
      syncTask(id, "approved");
      updateTaskUI(id, "approved");
    }

    function renderChores() {
      const tbody = document.getElementById("chore-body");
      Object.keys(chores).forEach(day => {
        const row = document.createElement("tr");
        const dayCell = document.createElement("td");
        dayCell.textContent = day;
        row.appendChild(dayCell);

        names.forEach(name => {
          const cell = document.createElement("td");
          const tasks = chores[day][name] || [];
          if (tasks.length === 0) {
            cell.innerHTML = "<em>Free</em>";
          } else {
            tasks.forEach((task, i) => {
              const id = `${name.toLowerCase()}-${day.toLowerCase()}-${i}`;
              const div = document.createElement("div");
              div.className = "task";

              const label = document.createElement("label");
              const checkbox = document.createElement("input");
              checkbox.type = "checkbox";
              checkbox.id = `${id}-checkbox`;
              checkbox.onchange = () => toggleTask(checkbox, id);
              label.appendChild(checkbox);
              label.append(task);

              const status = document.createElement("span");
              status.id = `${id}-status`;

              const approveBtn = document.createElement("button");
              approveBtn.id = `${id}-approve`;
              approveBtn.textContent = "Approve";
              approveBtn.style.display = "none";
              approveBtn.onclick = () => approveTask(id);

              div.appendChild(label);
              div.appendChild(status);
              div.appendChild(approveBtn);
              cell.appendChild(div);
            });
          }
          row.appendChild(cell);
        });
        tbody.appendChild(row);
      });
    }

    db.ref("tasks").on("value", snapshot => {
      const data = snapshot.val() || {};
      Object.entries(data).forEach(([id, status]) => {
        updateTaskUI(id, status);
      });
    });

    document.addEventListener("DOMContentLoaded", renderChores);
  </script>
</body>
</html>
