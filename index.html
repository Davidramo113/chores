
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Family Tasks</title>
<script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-database-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyA6hkZDTQrqhS6Wcm9z8ADm5It-wck7U8",
  authDomain: "chores-c86f4.firebaseapp.com",
  databaseURL: "https://chores-c86f4-default-rtdb.firebaseio.com",
  projectId: "chores-c86f4",
  storageBucket: "chores-c86f4.appspot.com",
  messagingSenderId: "503520134350",
  appId: "1:503520134350:web:0ce4fc7c3c011eaa0cbc9f"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const isParent = new URLSearchParams(window.location.search).get("user") === "parent";
let chores = {};
let taskStatuses = {};

const defaultChores = {
  Monday: {
    Jacob: ["Vacuum common areas", "Scoop/clean cat litter"],
    Jalyna: ["Wash dishes"],
    Josh: ["Take out trash"],
    Jeremy: ["Clean bedroom"]
  },
  Tuesday: {
    Jacob: ["Scoop/clean cat litter"],
    Jalyna: ["Wash dishes"],
    Josh: ["Wash dishes", "Take recycling to front curb"],
    Jeremy: ["Clean bedroom"]
  },
  Wednesday: {
    Jacob: ["Wash dishes", "Take trash to front curb"],
    Jalyna: ["Wipe down surfaces", "Scoop/clean cat litter"],
    Josh: ["Clean windows"],
    Jeremy: ["Clean bedroom"]
  },
  Thursday: {
    Jacob: ["Vacuum basement steps"],
    Jalyna: ["Wash dishes"],
    Josh: ["Wipe down appliances", "Scoop/clean cat litter"],
    Jeremy: ["Clean bedroom"]
  },
  Friday: {
    Jacob: ["Dust and sweep first floor"],
    Jalyna: ["Clean bathroom", "Scoop/clean cat litter"],
    Josh: ["Wash dishes"],
    Jeremy: ["Clean bedroom"]
  },
  Saturday: {
    Jacob: ["Wash dishes", "Scoop/clean cat litter"],
    Jalyna: ["Organize shared space"],
    Josh: ["Organize basement"],
    Jeremy: ["Clean bedroom"]
  },
  Sunday: {
    Jacob: [],
    Jalyna: [],
    Josh: [],
    Jeremy: []
  }
};

function syncTask(id, status) {
  db.ref("tasks/" + id).set(status);
}

function updateTaskUI(id, status) {
  const checkbox = document.getElementById(`${id}-checkbox`);
  const statusSpan = document.getElementById(`${id}-status`);
  const approveBtn = document.getElementById(`${id}-approve`);
  if (!checkbox || !statusSpan) return;

  if (status === "approved") {
    checkbox.checked = true;
    checkbox.disabled = true;
    statusSpan.textContent = "âœ… Approved";
    statusSpan.classList.add("approved");
    if (approveBtn) approveBtn.style.display = "none";
  } else if (status === "pending") {
    checkbox.checked = true;
    checkbox.disabled = false;
    statusSpan.textContent = "Pending";
    if (approveBtn && isParent) {
      approveBtn.style.display = "inline-block";
    } else if (approveBtn) {
      approveBtn.style.display = "none";
    }
  } else {
    checkbox.checked = false;
    checkbox.disabled = false;
    statusSpan.textContent = "";
    if (approveBtn) approveBtn.style.display = "none";
  }
}

function toggleTask(checkbox, id) {
  const status = checkbox.checked ? "pending" : "";
  syncTask(id, status);
  updateTaskUI(id, status);
}

function approveTask(id) {
  if (!isParent) return;
  syncTask(id, "approved");
  updateTaskUI(id, "approved");
}

function resetAllTasks() {
  if (!isParent) return;
  if (confirm("Are you sure you want to reset all tasks?")) {
    db.ref("tasks").remove();
    location.reload();
  }
}

function toggleTheme() {
  document.body.classList.toggle("dark");
}

function renderChores() {
  const tbody = document.getElementById("chore-body");
  const today = new Date().toLocaleDateString('en-US', { weekday: 'long' });
  const fullDate = new Date().toLocaleDateString();
  const orderedDays = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"];
  tbody.innerHTML = "";

  orderedDays.forEach(day => {
    const row = document.createElement("tr");
    if (day === today) row.classList.add("highlight-row");
    const dayCell = document.createElement("td");
    dayCell.textContent = day === today ? `${day} (${fullDate})` : day;
    row.appendChild(dayCell);

    const names = ["Jacob", "Jalyna", "Josh", "Jeremy"];
    names.forEach(name => {
      const cell = document.createElement("td");
      const tasks = chores[day]?.[name] || [];
      if (tasks.length === 0) {
        cell.innerHTML = "<em>Free</em>";
      } else {
        tasks.forEach((task, i) => {
          const id = `${name.toLowerCase()}-${day.toLowerCase()}-${i}`;
          const div = document.createElement("div");
          div.className = "task";

          const label = document.createElement("label");
          const checkbox = document.createElement("input");
          checkbox.type = "checkbox";
          checkbox.id = `${id}-checkbox`;
          checkbox.onchange = () => toggleTask(checkbox, id);
          label.appendChild(checkbox);
          label.append(task);

          const status = document.createElement("span");
          status.id = `${id}-status`;

          const approveBtn = document.createElement("button");
          approveBtn.id = `${id}-approve`;
          approveBtn.textContent = "Approve";
          approveBtn.style.display = "none";
          approveBtn.onclick = () => approveTask(id);

          div.appendChild(label);
          div.appendChild(status);
          div.appendChild(approveBtn);
          cell.appendChild(div);
        });
      }
      row.appendChild(cell);
    });
    tbody.appendChild(row);
  });

  Object.entries(taskStatuses).forEach(([id, status]) => {
    updateTaskUI(id, status);
  });
}

document.addEventListener("DOMContentLoaded", () => {
  if (isParent) document.getElementById("rotate-section").style.display = "block";

  db.ref("weeklyChores").on("value", snapshot => {
    const data = snapshot.val();
    if (data) {
      chores = data;
    } else {
      chores = defaultChores;
      db.ref("weeklyChores").set(defaultChores);
    }
    renderChores();
  });

  db.ref("tasks").on("value", snapshot => {
    taskStatuses = snapshot.val() || {};
    renderChores();
  });
});
</script>
</head>
<body>
<h1>Family Tasks</h1>

<button id="theme-toggle" onclick="toggleTheme()">Toggle Dark Mode</button>

<table>
<thead>
<tr><th>Day</th><th>Jacob</th><th>Jalyna</th><th>Josh</th><th>Jeremy</th></tr>
</thead>
<tbody id="chore-body"></tbody>
</table>

<!-- Rotate Tasks Button for Parent -->
<div id="rotate-section" style="text-align: center; margin-top: 20px; display: none;">
  <button onclick="resetAllTasks()" style="padding: 10px 20px; font-size: 16px;">Reset All Tasks</button>
</div>

<!-- Recycling and Garbage Notes -->
<div class="recycling-note">
â™»ï¸ <strong>Recycling (Tuesday Night - May 13):</strong> This week is for <strong>Paper/Cardboard</strong>. Please bring the correct bin to the curb.
</div>

<div class="garbage-note">
ğŸ—‘ï¸ <strong>Garbage Instructions:</strong> Garbage must be taken out before 9:00 PM the night before pickup. If not done, Wi-Fi may be disabled until complete. This is checked during task approval.
</div>

<!-- Links to PDFs -->
<div style="text-align: center; margin-top: 15px;">
  <a href="https://docs.google.com/gview?url=https://raw.githubusercontent.com/Davidramo113/chores/main/Cleaning_Standards_Guide_Updated.pdf&embedded=true" target="_blank" rel="noopener noreferrer" style="font-size: 16px; color: green; display: block;">
  ğŸ“„ View Cleaning Standards for Task Approval
</a>
</div>


<div id="reset-section" style="text-align: center; margin-top: 20px;">
  <button onclick="resetAllTasks()" style="padding: 10px 20px; font-size: 16px;">Reset All Tasks</button>
</div>

<div id="rotate-section" style="text-align: center; margin-top: 20px; display: none;">
  <button onclick="rotateChores()" style="padding: 10px 20px; font-size: 16px;">ğŸ” Rotate Tasks</button>
</div>

<div class="footer-note">
âœ… Complete tasks to regain Wi-Fi privileges. Parent approval required.
</div>

</body>
</html>
